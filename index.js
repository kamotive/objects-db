!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.objectsDB=t():e.objectsDB=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.BOOL=0]="BOOL",e[e.I8=1]="I8",e[e.U8=2]="U8",e[e.I16=3]="I16",e[e.U16=4]="U16",e[e.I32=5]="I32",e[e.U32=6]="U32",e[e.I64=7]="I64",e[e.U64=8]="U64",e[e.F32=9]="F32",e[e.F64=10]="F64",e[e.STR=11]="STR",e[e.ARR=12]="ARR",e[e.JSON=15]="JSON"}(n||(n={}));const o=new Set([n.STR,n.ARR,n.JSON]),s={[n.BOOL]:1,[n.I8]:1,[n.U8]:1,[n.I16]:2,[n.U16]:2,[n.I32]:4,[n.U32]:4,[n.I64]:8,[n.U64]:8,[n.F32]:4,[n.F64]:8,[n.STR]:4,[n.ARR]:4,[n.JSON]:4};t.default=class{constructor(){this._propertiesMapName=new Map,this._propertiesMapId=new Map,this._selectorsMap=new Map,this._textDecoder=new TextDecoder,this._view=null,this._u32=null,this._u8=null}async load(e){this.reset();const t=await new Promise((t,r)=>{const n=new XMLHttpRequest;n.responseType="arraybuffer",n.open("GET",e,!0),n.onload=()=>{n.status>=200&&n.status<300?t(n.response):r(new Error(`Request "${e}" error, status ${n.status}`))},n.onerror=e=>r(e),n.send(null)});this._u32=new Uint32Array(t,0,Math.floor(t.byteLength/4)),this._u8=new Uint8Array(t),this._view=new DataView(t);const r=this._u32,n=r[2]>>16;for(let e=0;e<n;e++){const t=268435455&r[4+e],n=r[4+e]>>>28,o=this._decodeString(t);this._propertiesMapName.set(o,e),this._propertiesMapId.set(e,{type:n,name:o})}}reset(){this._propertiesMapName.clear(),this._propertiesMapId.clear(),this._selectorsMap.clear(),this._u32=null,this._u8=null}async request(e,t){if(null===this._u32)throw new Error("Not load DB!");const r=[],n=null===e?this._fullIterator():e,o=new Set,s=this._u32[2]>>16;if(void 0!==t)for(const e of t){const t=this._propertiesMapName.get(e);void 0!==t?o.add(t):console.error(`Property "${e}" doesn't exist`)}else for(let e=0;e<s;e++)o.add(e);for(const e of n)r.push(this._getObject(e,o));return r}_getObject(e,t){const r=this._view,o=this._u32,s=o[4+(o[2]>>16)+e],i=r.getUint16(s,!0),a={};for(let e=0;e<i;e++){const o=r.getUint16(s+6*e+2,!0);if(!t.has(o))continue;const i=s+6*e+4,c=r.getUint32(i,!0),u=this._propertiesMapId.get(o).type;let d;switch(u){case n.BOOL:d=Boolean(i);break;case n.I8:d=r.getInt8(i);break;case n.U8:d=r.getUint8(i);break;case n.I16:d=r.getInt16(i,!0);break;case n.U16:d=r.getUint16(i,!0);break;case n.U32:d=r.getUint32(i,!0);break;case n.I32:d=r.getInt32(i,!0);break;case n.F64:d=r.getFloat64(c,!0);break;case n.STR:d=this._decodeString(c);break;case n.ARR:d=this._decodeArray(c);break;case n.JSON:d=this._decodeJSON(c);break;default:throw new Error(`Type ${u} not supported`)}a[this._propertiesMapId.get(o).name]=d}return a}*_fullIterator(){let e=0;for(;e<this._u32[3];)yield e++;return!1}_decodeJSON(e){const t=this._decodeString(e);return JSON.parse(t)}_decodeArray(e){const t=this._view,r=t.getUint8(e),i=t.getUint16(e+1,!0),a=[],c=s[r];if(o.has(r)){let o=this._decodeString.bind(this);switch(r){case n.STR:o=this._decodeString.bind(this);break;case n.JSON:o=this._decodeJSON.bind(this);break;case n.ARR:o=this._decodeArray.bind(this);break;default:throw new Error("Unknown array type "+r)}for(let r=0;r<i;r+=4){const n=t.getUint32(e+r+3,!0);a.push(o(n))}return a}let u=t.getInt8.bind(t);switch(r){case n.I8:u=t.getInt8.bind(t);break;case n.U8:u=t.getUint8.bind(t);break;case n.I16:u=t.getInt16.bind(t);break;case n.U16:u=t.getUint16.bind(t);break;case n.I32:u=t.getInt32.bind(t);break;case n.U32:u=t.getUint32.bind(t);break;case n.F32:u=t.getFloat32.bind(t);break;case n.F64:u=t.getFloat64.bind(t);break;default:throw new Error("Unknown array type "+r)}for(let t=0;t<i;t+=c)a.push(u(e+t+3,!0));return a}_decodeString(e){const t=this._u8,r=this._view.getUint16(e,!0),n=new Uint8Array(t.buffer,e+2,r);return this._textDecoder.decode(n)}_decodeString2(e){const t=[],r=this._u8,n=this._view.getUint16(e,!0),o=e+2;let s=o;for(t.length=0;s-o<n;)if(r[s]<128)t.push(r[s]),s++;else if(r[s]<224)t.push((31&r[s])<<6|63&r[s+1]),s+=2;else if(r[s]<240)t.push((15&r[s])<<12|(63&r[s+1])<<6|63&r[s+2]),s+=3;else{if(!(r[s]<248))throw new Error("Invalid char code");t.push((7&r[s])<<18|(63&r[s+1])<<12|(63&r[s+2])<<6|63&r[s+3]),s+=4}return String.fromCharCode(...t)}}}])}));